// 아이디의 길이는 3자 이상 15자 이하여야 합니다.
// 아이디는 알파벳 소문자, 숫자, 빼기(-), 밑줄(_), 마침표(.) 문자만 사용할 수 있습니다.
// 단, 마침표(.)는 처음과 끝에 사용할 수 없으며 또한 연속으로 사용할 수 없습니다.
class Solution {
    fun solution(new_id: String): String {

        var answer = StringBuilder()
        var isDotStacked: Boolean = false

        fun deleteDotAtFirstOrLast(stringBuilder: StringBuilder): StringBuilder{
            if(stringBuilder.length>0 && stringBuilder.first() == '.'){
                stringBuilder.deleteCharAt(0)
            }
            if(stringBuilder.length>0 && stringBuilder.last() == '.'){
                stringBuilder.deleteCharAt(stringBuilder.length -1)
            }
            return stringBuilder
        }

        fun dotHandling(char: Char?):String{    // step 3
            if(char == null){
              return ""
            }
            else if(char == '.'){
                if (!isDotStacked) isDotStacked = true
                return ""
            }
            else{
                if(!isDotStacked) return char.toString()
                isDotStacked = false
                return ".${char}"
            }    
        }

        for (each in new_id){
            answer.append(dotHandling(
                when (each){
                  in 'A'..'Z' -> each.toLowerCase() //step1
                  in 'a'..'z', in '0'..'9', '-', '_', '.' -> each
                  else -> null  //step 2
                }
              )
            )
        }

        answer = deleteDotAtFirstOrLast(answer)   // step 4
        if(answer.length == 0) answer.append('a') // step 5
        if(answer.length > 15) answer = deleteDotAtFirstOrLast(StringBuilder(answer.substring(0,15)))   // step 6
        answer = deleteDotAtFirstOrLast(answer)   // step 6+
        while(answer.length<3){
            answer.append(answer.last())
        }

        return answer.toString()

    }

}
